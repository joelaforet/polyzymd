"""Trajectory analysis module for PolyzyMD.

This module provides tools for analyzing MD simulation trajectories
generated by PolyzyMD, with proper statistical handling across
multiple replicates.

Submodules
----------
core
    Infrastructure: config hashing, statistics, autocorrelation, loading
results
    Pydantic models for analysis results
rmsf
    RMSF (Root Mean Square Fluctuation) analysis
distances
    Inter-atomic distance analysis
triad
    Catalytic triad/active site geometry analysis
contacts
    Polymer-protein contact analysis with extensible criteria
common
    Shared infrastructure: molecular selectors, residue groupings

Quick Start
-----------
>>> from polyzymd.config import load_config
>>> from polyzymd.analysis import RMSFCalculator, DistanceCalculator, CatalyticTriadAnalyzer
>>>
>>> config = load_config("config.yaml")
>>>
>>> # RMSF analysis
>>> rmsf_calc = RMSFCalculator(config, selection="protein and name CA", equilibration="100ns")
>>> result = rmsf_calc.compute_aggregated(replicates=[1, 2, 3, 4, 5])
>>> print(f"RMSF: {result.overall_mean_rmsf:.2f} ± {result.overall_sem_rmsf:.2f} Å")
>>>
>>> # Distance analysis
>>> pairs = [("resid 77 and name OG", "resid 133 and name NE2")]
>>> dist_calc = DistanceCalculator(config, pairs=pairs, equilibration="100ns")
>>> result = dist_calc.compute(replicate=1)
>>>
>>> # Catalytic triad analysis (with CatalyticTriadConfig from compare.config)
>>> from polyzymd.compare.config import CatalyticTriadConfig, TriadPairConfig
>>> triad_config = CatalyticTriadConfig(name="LipA_triad", threshold=3.5, pairs=[...])
>>> triad_analyzer = CatalyticTriadAnalyzer(config, triad_config, equilibration="100ns")
>>> result = triad_analyzer.compute(replicate=1)
>>>
>>> # Contact analysis
>>> from polyzymd.analysis import ContactAnalyzer, AnyAtomWithinCutoff
>>> from polyzymd.analysis.common import ProteinResidues, PolymerChains
>>> analyzer = ContactAnalyzer(
...     target_selector=ProteinResidues(),
...     query_selector=PolymerChains(),
...     criteria=AnyAtomWithinCutoff(cutoff=4.0),
... )
>>> result = analyzer.run(universe)

Installation
------------
Analysis tools require optional dependencies:

    pip install polyzymd[analysis]

This installs MDAnalysis and matplotlib.
"""


# Lazy imports to avoid loading MDAnalysis unless needed
def __getattr__(name):
    """Lazy import of analysis components."""
    if name == "RMSFCalculator":
        from polyzymd.analysis.rmsf import RMSFCalculator

        return RMSFCalculator
    elif name == "DistanceCalculator":
        from polyzymd.analysis.distances import DistanceCalculator

        return DistanceCalculator
    elif name == "CatalyticTriadAnalyzer":
        from polyzymd.analysis.triad import CatalyticTriadAnalyzer

        return CatalyticTriadAnalyzer
    elif name == "TrajectoryLoader":
        from polyzymd.analysis.core.loader import TrajectoryLoader

        return TrajectoryLoader
    elif name == "compute_config_hash":
        from polyzymd.analysis.core.config_hash import compute_config_hash

        return compute_config_hash
    elif name == "validate_config_hash":
        from polyzymd.analysis.core.config_hash import validate_config_hash

        return validate_config_hash
    elif name == "AnalysisConfig":
        from polyzymd.analysis.config import AnalysisConfig

        return AnalysisConfig
    elif name == "generate_analysis_template":
        from polyzymd.analysis.config import generate_analysis_template

        return generate_analysis_template
    elif name in ("plot_rmsf", "plot_rmsf_comparison", "save_rmsf_plot"):
        from polyzymd.analysis import rmsf

        return getattr(rmsf, name)
    elif name in ("plot_distance_histogram", "plot_distance_comparison", "save_distance_plot"):
        from polyzymd.analysis import distances

        return getattr(distances, name)
    # Contact analysis module
    elif name == "ContactAnalyzer":
        from polyzymd.analysis.contacts import ContactAnalyzer

        return ContactAnalyzer
    elif name == "ParallelContactAnalyzer":
        from polyzymd.analysis.contacts import ParallelContactAnalyzer

        return ParallelContactAnalyzer
    elif name in (
        "ContactCriteria",
        "AnyAtomWithinCutoff",
        "AnyAtomToCOM",
        "COMToCOM",
        "MinimumDistance",
    ):
        from polyzymd.analysis import contacts

        return getattr(contacts, name)
    elif name in ("ContactEvent", "ResidueContactData", "ContactResult"):
        from polyzymd.analysis import contacts

        return getattr(contacts, name)
    elif name == "aggregate_contact_results":
        from polyzymd.analysis.contacts.aggregator import aggregate_contact_results

        return aggregate_contact_results
    raise AttributeError(f"module {__name__!r} has no attribute {name!r}")


__all__ = [
    # Calculators
    "RMSFCalculator",
    "DistanceCalculator",
    "CatalyticTriadAnalyzer",
    # Contact analysis
    "ContactAnalyzer",
    "ParallelContactAnalyzer",
    "ContactCriteria",
    "AnyAtomWithinCutoff",
    "AnyAtomToCOM",
    "COMToCOM",
    "MinimumDistance",
    "ContactEvent",
    "ResidueContactData",
    "ContactResult",
    "aggregate_contact_results",
    # Loading
    "TrajectoryLoader",
    # Config validation
    "compute_config_hash",
    "validate_config_hash",
    # Analysis configuration
    "AnalysisConfig",
    "generate_analysis_template",
    # Plotting (RMSF)
    "plot_rmsf",
    "plot_rmsf_comparison",
    "save_rmsf_plot",
    # Plotting (Distances)
    "plot_distance_histogram",
    "plot_distance_comparison",
    "save_distance_plot",
]
