# ============================================================================
# PolyzyMD Configuration: Enzyme + Co-Polymer Simulation
# ============================================================================
# Full simulation with enzyme, docked substrate, and co-polymers
# Primary use case for studying enzyme-polymer interactions
# ============================================================================

name: "LipA_ResorufinButyrate_SBMA-EGPMA"
description: "LipA enzyme with Resorufin-Butyrate and SBMA-EGPMA co-polymers"

# ============================================================================
# Enzyme Configuration
# ============================================================================
enzyme:
  name: "LipA"
  pdb_path: "structures/LipA_prepared.pdb"
  description: "Bacillus subtilis Lipase A"

# ============================================================================
# Substrate Configuration (Docked Ligand)
# ============================================================================
substrate:
  name: "Resorufin-Butyrate"
  sdf_path: "structures/resorufin_butyrate_docked.sdf"
  conformer_index: 0
  charge_method: "nagl"
  residue_name: "RBY"

# ============================================================================
# Polymer Configuration
# ============================================================================
polymers:
  enabled: true
  type_prefix: "SBMA-EGPMA"  # Identifier for the co-polymer type
  
  # Monomer composition with probabilities
  monomers:
    - label: "A"
      probability: 0.98
      name: "SBMA"
    - label: "B"
      probability: 0.02
      name: "EGPMA"
  
  length: 5  # 5-mer chains
  count: 2  # 2 polymer chains
  
  # Optional: path to pre-built polymer SDF files
  # If not provided, polymers will be generated on-the-fly
  sdf_directory: "polymer_sdfs/SBMA-EGPMA"
  
  # Cache for generated polymers
  cache_directory: ".polymer_cache"
  
  # Random seed for polymer sequence generation (optional)
  # If not set, uses the replicate number as the seed.
  # Set this for reproducible polymer sequences across different replicates.
  # random_seed: 42
  
  # Packing settings for polymers around the protein
  # Larger padding helps PACKMOL converge when packing polymers
  packing:
    padding: 2.0  # nm padding around solute for polymer box
    tolerance: 2.0  # PACKMOL tolerance (Angstrom)

# ============================================================================
# Solvent Configuration
# ============================================================================
solvent:
  primary:
    type: "water"
    model: "tip3p"
  
  co_solvents: []  # No co-solvents for this simulation
  
  ions:
    neutralize: true
    nacl_concentration: 0.1  # 100 mM NaCl
  
  box:
    padding: 2.0  # nm padding (2.0 recommended for PACKMOL convergence)
    shape: "rhombic_dodecahedron"
    target_density: 1.0
    tolerance: 2.0

# ============================================================================
# Restraints
# ============================================================================
restraints:
  - type: "flat_bottom"
    name: "substrate_active_site"
    atom1:
      selection: "resid 77 and name OG"
      description: "Catalytic serine"
    atom2:
      selection: "resname RBY and name C1"
      description: "Substrate reactive carbon"
    distance: 3.3
    force_constant: 10000.0
    enabled: true

# ============================================================================
# Thermodynamics
# ============================================================================
thermodynamics:
  temperature: 293.0  # 20Â°C
  pressure: 1.0

# ============================================================================
# Simulation Phases
# ============================================================================
simulation_phases:
  equilibration:
    ensemble: "NVT"
    duration: 0.5
    samples: 50
    time_step: 2.0
    thermostat: "LangevinMiddle"
    thermostat_timescale: 1.0
  
  production:
    ensemble: "NPT"
    duration: 100.0  # 100 ns total
    samples: 2500
    time_step: 2.0
    thermostat: "LangevinMiddle"
    thermostat_timescale: 1.0
    barostat: "MC"
    barostat_frequency: 25
  
  segments: 10  # 10 segments of 10 ns each

# ============================================================================
# Output Configuration
# ============================================================================
# HPC systems often separate long-term storage (projects) from high-performance
# scratch storage. Configure both directories here, or use CLI overrides.
#
# Memory requirements for polymer systems:
#   - Polymer systems require more memory due to larger system sizes
#   - Default 3G may cause OOM errors during energy minimization
#   - Recommended: polyzymd submit --memory 4G (or 6-8G for many polymers)
#
output:
  # Long-term storage: scripts, logs, configs (survives job completion)
  # Example: /projects/$USER/polyzymd or just "." for local development
  projects_directory: "."
  
  # High-performance scratch: trajectories, checkpoints (may be purged)
  # Example: /scratch/alpine/$USER/simulations
  # If not set, defaults to projects_directory (good for local testing)
  scratch_directory: null
  
  # Subdirectory organization within projects_directory
  job_scripts_subdir: "job_scripts"
  slurm_logs_subdir: "slurm_logs"
  
  # Naming template for run directories
  naming_template: "{enzyme}_{substrate}_{polymer_type}_{temperature}K_run{replicate}"
  
  # Output options
  save_checkpoint: true
  save_state_data: true
  trajectory_format: "dcd"

# ============================================================================
# Force Field Selection
# ============================================================================
force_field:
  protein: "ff14sb_off_impropers_0.0.4.offxml"
  small_molecule: "openff-2.0.0.offxml"
